# Nash Equilibrium and Cooperative Game Analysis

This repository contains several Python scripts for evaluating river resilience policies using game theory. The analysis is based on a setting in which an Upstream player (e.g., a regional government) and a Downstream player (e.g., a municipality) choose among various flood mitigation actions. The outcomes are evaluated across multiple dimensions—public expenditure, flood damage, and ecosystem impact—using Monte Carlo simulation and then aggregated via weighted sums. Game theoretic methods are applied to examine both non‐cooperative (Nash equilibrium) and cooperative (core, Shapley Value) solution concepts, as well as a simple Borda rule.

## File Contents

- **`nash_equilibrium_core.py`**  
  This script performs non-cooperative and cooperative game analyses in a 2-player setting. It:
  - Defines strategies for the Upstream and Downstream players.
  - Uses payoff tables that capture environmental, economic, and safety contributions for each strategy pair.
  - Aggregates these dimensions with user-defined weights.
  - Finds pure-strategy Nash equilibria.
  - Computes a characteristic function \(v(S)\) for each coalition and checks whether the core is empty.
  - Calculates the Shapley Value for 2 players.
  - Demonstrates a simple Borda rule for ranking strategy pairs.

- **`sim_river_resilience.py`**  
  This script simulates river resilience policies for a typical Japanese municipality over the period 2025–2100. In our model:
  - A forest investment increases forest retention with a fixed delay.
  - A dam investment increases dam capacity with some delay and is scaled by a random multiplier at a certain cost.
  - An embankment investment increases embankment capacity with a delay with similar scaling, at a certain cost.
  - Residential relocation has an immediate effect, removing relocated houses (e.g., 100 houses) from flood risk at a certain cost.
  - Each year, the model generates rainfall based on realistic values and compares it against the total protection capacity (the sum of forest, dam, and embankment capacities). If rainfall exceeds this capacity, flood damage is incurred based on the excess, the number of at-risk houses, and a damage coefficient.
  - The ecosystem indicator is updated annually based on the positive effects of forest investments, negative impacts of dam and embankment investments, and environmental variability.
  
  The simulation runs multiple (e.g., 1,000) Monte Carlo trials for each of the 16 possible policy combinations. Detailed trial results are written to a CSV file (`sim_data.csv`) where each row contains the following columns:  
  `Forest, Dam, Embankment, Relocation, Run, upstream_cost, downstream_cost, cumulative_damage, final_ecosystem`.

- **`game_river_resilience.py`**  
  This script reads the CSV file (`sim_data.csv`) generated by `sim_river_resilience.py` and reconstructs the simulation data in the same format as used in our analyses. It then:
  - Extracts evaluation metrics (using selected risk percentiles—for example, the 95th percentile).
  - Normalizes the outcomes (with lower values being better for public expenditure and flood damage, and higher values being better for the ecosystem).
  - Applies user-defined weights to aggregate these outcomes into composite payoffs for the Upstream and Downstream players.
  - Performs game theoretic analyses including the search for pure-strategy Nash equilibria, core checks, Shapley Value computation, and a simple Borda rule ranking.
  - Visualizes the distribution of flood damage versus ecosystem outcomes for the different policy combinations using scatter plots.

## Installation (with Poetry)

1. **Clone the repository** or copy the scripts into your project.

2. **Install Poetry** (if not already installed). For example:
   ```bash
   pip install poetry
   ```
   or follow the instructions on [Poetry’s official documentation](https://python-poetry.org/docs/).

3. **Set up your project environment** by creating a `pyproject.toml` file. For example:
   ```toml
   [tool.poetry]
   name = "nash-equilibrium-core"
   version = "0.1.0"
   description = "Analysis of Nash Equilibria and Cooperative Game in river resilience policies"
   authors = ["Your Name <you@example.com>"]
   python = "^3.8"

   [tool.poetry.dependencies]
   numpy = "^1.21.0"
   matplotlib = "^3.5.0"

   [tool.poetry.scripts]
   nash = "nash_equilibrium_core:main"

   [tool.poetry.dev-dependencies]
   pytest = "^7.0.0"
   ```

4. **Install the dependencies**:
   ```bash
   poetry install
   ```

5. **Activate the virtual environment**:
   ```bash
   poetry shell
   ```
   or run commands via:
   ```bash
   poetry run python nash_equilibrium_core.py
   ```

## Usage

### sim_river_resilience.py

Run the simulation for various policy combinations (forest, dam, embankment, relocation) over the period 2025–2100:

```bash
poetry run python sim_river_resilience.py
```

This will generate a CSV file named `sim_data.csv` in the working directory. Each row in the CSV corresponds to one Monte Carlo trial of a given policy combination, with columns for the decision flags (Forest, Dam, Embankment, Relocation), trial number, and outcomes (upstream cost, downstream cost, cumulative flood damage, and final ecosystem index).

### game_river_resilience.py

After generating `sim_data.csv`, run the following script to load the simulation data and perform game theory analyses:

```bash
poetry run python game_river_resilience.py
```

This script will:
- Read `sim_data.csv` and reconstruct the simulation data.
- Extract outcome metrics based on selected risk percentiles.
- Normalize and weight the outcomes to compute composite payoffs.
- Identify pure-strategy Nash equilibria, check the core, compute Shapley Values, and apply a Borda rule.
- Display scatter plots of flood damage versus ecosystem outcomes for the 16 policy combinations.

### nash_equilibrium_core.py

The existing `nash_equilibrium_core.py` script remains in the repository. It provides additional examples of non-cooperative and cooperative game analysis techniques that you can run independently.

## Customizing the Model

- **Parameter Adjustments**:  
  The parameters in `sim_river_resilience.py` have been calibrated to reflect realistic conditions for a Japanese municipality. You may adjust the initial capacities, investment effects, delays, costs, and rainfall parameters to match local data.
- **Risk Attitude**:  
  The risk percentiles used for outcome extraction (e.g., 95th percentile) can be modified in both simulation and game analysis scripts to reflect different risk preferences.
- **Weight Settings**:  
  You can modify the weights assigned to economic cost, flood damage, and ecosystem impact in the composite payoff calculations to reflect different policy priorities.

## License

[MIT License](LICENSE)

## Contributing

Please open an issue or submit a pull request if you have suggestions for improvements, additional analyses, or bug fixes.

## Author

Takuya Nakashima